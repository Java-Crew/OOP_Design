# 역할, 책임, 협력

> 객체 지향 세계에서 가장 중요한 건 역할, 책임, 협력이다.

## 협력

### 영화 예매 시스템 돌아보기

영화 예매 시스템을 완성하기 위해 다양한 객체가 협력을 하고 메시지를 주고 받으며 상호작용을
하였다. 

다양한 객체들이 영화 예매라는 기능을 구현하기 위해 메시지를 주고 받으면서 상호작용을 한다는
점이다. 이처럼 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용을 `협력`이라고
한다.
객체가 협력에 참여하기 위해 수행하는 로직은 `책임`이라고 한다. 객체들이 협력 안에서
수행하는 책임들이 모여 객체가 수행하는 `역할`을 구성한다.

### 협력

객체는 고립된 존재가 아니라 시스템의 기능이라는 더 큰 목표를 달성하기 위해 다른 객체와 
협력하는 사회적인 존재다. 협력은 객체지향 세계에서 기능을 구현할 수 있는 유일한 방법이다.
메시지 전송은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단이다. 

객체는 다른 객체의 상세한 내부 구현에 직접 접근할 수 없기 때문에 오직 메시지 전송을 
통해 서만 자신의 요청을 전달할 수 있다.

> 협력이란 어떤 객체가 다른 객체에게 무엇인가를 요청하는 것이다. 한 객체는 어떤 것이 
> 필요할 때 다른 객체에게 전적으로 위임하거나 서로 협력한다. 즉, 두 객체가 상호작용을 
> 통해 더 큰 책임을 수행하는 것이다. 객체 사이의 협력을 설계할 때는 객체를 서로 분리된
> 인스턴스가 아닌 협력 파트너로 인식 해야한다.


메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다. 여기서 객체가 메시지를 처리할 방법을
스스로 선택하는 것이 핵심이다. 외부의 객체는 오직 메시지를 전송받는 것만 가능하다.

Screening과 Movie의 협력관계를 나타내보자.

<img src="/static/그림 3.2.png" alt="그림 3.2" width="601" height="71"></img>

Screening이 Movie에게 처리를 위임하는 이유는 요금을 계산하는데 필요한 기본 요금과 
할인 정책을 가장 잘알고 있는 객체가 Movie이기 때문이다. 요금을 계싼하는 작업을 Screening
이 수행한다면 Movie의 인스턴스 변수인 fee와 discountPolicy에 직접 접근해야만 할 것이다.
이 경우 Screening은 Movie의 내부 구현에 결합된다.

이 때 가장 큰 문제점은 Movie의 자율성이 훼손된다는 것이다. 자율적인 객체란 자신의 상태를 
직접 관리하고 스스로의 결정에 따라 헹동하는 객체다. 객체의 자율성을 보장하기 위해서는 필요한
정보를 이용해 요금을 계산할 경우 정보와 행동이 Movie와 Screening이라는 별도의 객체로
나뉜다. 결과적으로 Movie는 자율적인 존재가 아닌 수동적인 존재가 되버린다.

자율적인 존재가 되기 위해선 자신이 할 수 없는 일을 다른 객체에 위임하면 협력에 참여하는
객체들의 전체적인 자율성을 향상시킬 수 있다.

결과 적으로 객체를 자율 적으로 만드는 것은 내부 구현을 캡슐화 하는 것이다. 캡슐화를 통해 변경
에 대한 파급효과를 제한할 수 있기 때문에 자율적인 객체는 변경하기도 쉬워진다.

정리 하자면, 자율 적인 객체는 자신에게 할당된 책임을 수행하던 중에 필요한 정보를 알지 못하 
거나 외부의 도움이 필요한 경우 적절한 객체에게 메시지를 전송 해서 협력을 요청 한다. 메시지를 
수신한 객체 역시 메시지를 처리하던 중에 직접 처리할 수 없는 정보나 행동이 필요한 경우 
또 다른 객체에게 도움을 요청 한다. 이처럼 객체들 사이의 협력을 구성 하는 일련의 요청과 
응답의 흐름을 통해 애플리케이션의 기능이 구현 된다.


### 협력이 설계를 위한문맥을 결정한다.

객체 지향은 객체 중심에 놓는 프로그래밍 패러다임이다. 여기서 객체란 상태와 행동을 함께
캡슐화하는 실행 단위다. 그렇다면 객체가 가질 수 있는 상태와 행동을 어떤 기준으로 결정
해야할까? 객체를 설계 할 떄 어떤 행동과 상태를 할당했다면 그 이유는 무엇인가?

어떤 객체도 섬이 아니다. 애플리케이션 안에 어떤 객체가 필요하다면 그 이유는 단 하나여야
한다.

결론적으로, 객체의 행동을 결정하는 것은 객체가 참여하고 있는 협력이다. 협력이 바뀌면 객체가
제공 해야 하는 행동 역시 바뀌어야 한다. 협력은 객체가 필요한 이유와 객체가 수행하는 행동의
동기를 제공한다.

```java
import chapter02.step02.Screening;

public class Movie {
    private Money fee;
    private DisountPolicy disountPolicy;

    public Money calculateMovieFee(Screening screening) {
        return fee.minus(disountPolicy.calculateDiscountAmount(screening));
    }
}
```

상태는 객체가 행동하는 데 필요한 정보에 의해 결정되고 행동은 협력 안에서 객체가 처리할
메시지로 처리된다. 결과적으로 객체가 참여하는 협력이 객체를 구성하는 행동과 상태 모두를
결정한다. 따라서 협력은 객체를 설계하는 데 일종의 문맥을 제공한다.

## 책임

객체를 설계하기 위해 필요한 문맥인 협력이 갖춰졌다고 하자. 다음으로 할 일은 협력에 필요한
행동을 수행할 수 있는 적절한 객체를 찾는 것이다. 이 때 협력에 참여하기 위해 객체가 수행
하는 행동을 책임이라고 부른다.

객체의 책임은 무엇을 알고 있는가와 무엇을 할 수 있는가로 구성된다. 

이러한 분류 체계에 따라 객체의 책임을 크게 하는 것과 아는 것으로 나누었다.

- 하는 것
  - 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
  - 다른 객체의 행동을 시작시키는 것
  - 다른 객체의 행동을 제어하고 조절하는 것


- 아는 것
  - 사적인 정보에 관해 아는 것
  - 관련된 객체에 관해 아는 것
  - 자신이 유도하거나 계싼할 수 있는 것에 대해 아는 것

영화 예매 시스템에서 Screening은 영화를 예매하는 책임, Movie는 요금을 계산하는 책임을
갖고 있다. Screening은 예매를 할 수 있어야 한다. 이는 아는 것에 대한 책임이다.
Movie는 예매 가격을 계산할 책임을 갖는다. 이는 하는 것에 대한 책임이다. 또한 가격과 어떤
할인 정책이 적용 됐는지도 알고 있어야 한다. 이것은 아는 것에 대한 책임이다.

이처럼 객체에서 할당한 책임이 외부의 인터페이스와 내부의 속성을 결정한다.

> 객체지향 설계에서 가장 중요한 것은 설계이다. 객체에게 얼마나 적절한 책임을 할당
> 하느냐가 설계의 전체적인 품질 을 결정한다.

### 책임 할당

자율적인 객체를 만드는 가장 기본적인 방법은 책임을 수행하는 데 필요한 정보를 가장 잘알고
있는 전문가에게 그 책임을 할당하는 것이다. 이를 책임할당을 위한 `INFORMATION EXPERT`
(정보 전문가) 패턴이라고 부른다.

객체들 역시 협력에 필요한 지식과 방법을 가장 잘 알고 있는 객체에게 도움을 요청한다.
요청에 응답하기 위해 필요한 이 행동이 객체가 수행할 책임으로 이어지는 것이다.

따라서 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야 한다. 협력을 
설계하는 출발점은 시스템이 사용자에게 제공하는 기능을 시스템이 담당할 하나의 책임으로
바라보는 것이다.

시스템이 사용자에게 제공해야 할 기능은 영화를 예매하는 것이고 이 기능을 시스템이 제공할
책임으로 할당할 것이다. 객체가 책임을 수행하게 하는 유일한 방법은 메시지를 전송하는 것
이므로 책임을 할당한다는 것은 메시지의 이름을 결정하는 것과 같다. 이 예에서 예매하라는
이름의 메시지로 협력을 시작하는 것이 좋을 거같다.

메시지를 선택했으면 처리할 객체를 선택해야 한다. 영화를 예매하는 책임은 영화를 예매하기
위해서는 사영 시간과 기본 요금을 알아야한다. 이 정보는 Screening이 갖고 있다.

<img src="/static/그림 3-3.png" width="401" height="101"></img>

영화를 예매하기 위해서는 예매 가격을 계산해야 하지만 Screening은 예매 가격을 계산하는 데
충분한 정보가 없다. 예매에 대해서는 전문가이지만 영화 가격에 대한 전문가가 필요하다. 
따라서 새로운 메시지가 필요하다.

가격을 계산하라라는 메시지를 가격을 계산하고 할인 정책을 알고 있는 Movie에게 할당하는 것이
가장 바람직하다.

<img src="/static/그림 3-4.png" width="621" height="101"></img>

